name:  'Reusable workflow to deploy'

on: 
  workflow_call:
    inputs:
      environment:
        required: true
        type: string

jobs:
  job_deploy_infrastructure:
    uses: ./.github/workflows/deploy_Infra.yml
    env:
      resourceGroupName: 'GitHubTestRG'
    with:
      customParameters: 'votingWebAppName=SergioApp env=${{ inputs.environment }}'
      environment: ${{ inputs.environment }}
    secrets: inherit

  job_deploy_webapi:
    needs: 
      - job_deploy_infrastructure
    uses: ./.github/workflows/deploy_App.yml
    env:
      dotNetVersion: '3.1.x'
    with:
      azureWebAppName: 'web-votingapi-SergioApp-${{ inputs.environment }}'
      webAppSourcePath: '.\App-Demo\src\VotingData'
      environment: ${{ inputs.environment }}
    secrets: inherit

  job_deploy_webapp:
    needs: 
      - job_deploy_infrastructure
    uses: ./.github/workflows/deploy_App.yml
    env:
      dotNetVersion: '3.1.x'
    with:
      azureWebAppName: 'web-SergioApp-${{ inputs.environment }}'
      webAppSourcePath: '.\App-Demo\src\VotingWeb'
      environment: ${{ inputs.environment }}
    secrets: inherit


  job_deploy_function:
    needs: 
      - job_deploy_infrastructure
    uses: ./.github/workflows/deploy_App.yml
    env:
      dotNetVersion: '3.1.x'
    with:
      azureWebAppName: 'func-votecounter-SergioApp-${{ inputs.environment }}'
      webAppSourcePath: '.\App-Demo\src\FunctionApp'
      environment: ${{ inputs.environment }}
    secrets: inherit

